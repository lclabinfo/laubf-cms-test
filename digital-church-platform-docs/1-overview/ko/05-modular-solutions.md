# 05. 모듈형 솔루션 아키텍처

## 개요

Digital Church Platform은 교회가 필요한 솔루션만 선택하여 구독할 수 있는 모듈형 아키텍처를 채택합니다.
기존 Plan 기반 티어 시스템과 함께 하이브리드 접근 방식을 제공합니다.

---

## 구독 모델 비교

### Option 1: Plan 기반 (전통적 Tier)

| Plan | 월 가격 | 포함 기능 | 대상 |
|------|---------|-----------|------|
| **Starter** | Free ~ $29 | Website | 소규모 교회, 시작 단계 |
| **Growth** | $79 | Website, Members, Giving, Events | 성장하는 교회 |
| **Pro** | $149 | Growth + App, Groups, Streaming | 중대형 교회 |
| **Enterprise** | Custom | 전체 기능 + 화이트라벨 | 대형교회, 멀티사이트 |

### Option 2: 모듈형 À la carte

| Module ID | 모듈명 | 설명 | 월 가격 |
|-----------|--------|------|---------|
| `website` | Church Website | 교회 웹사이트 (필수) | $29 |
| `mobile-app` | Smartphone App | iOS/Android 네이티브 앱 | $49 |
| `giving` | Online Giving | 헌금 및 기부 시스템 | $39 |
| `members` | Member Management | 성도 관리 시스템 | $29 |
| `events` | Event Registration | 이벤트 등록/예약 | $19 |
| `groups` | Small Groups | 소그룹 관리 | $19 |
| `streaming` | Live Streaming | 라이브 예배 스트리밍 | $59 |
| `check-in` | Child Check-in | 어린이 체크인 시스템 | $29 |
| `ai-shorts` | AI Shorts Creator | AI 설교 숏폼 영상 생성 | $49 |
| `ai-social` | AI Social Studio | AI SNS 콘텐츠 생성 | $39 |

### Option 3: Hybrid (Plan + 추가 모듈)

Plan을 기본으로 선택하고, 필요한 추가 모듈을 À la carte로 추가하는 방식입니다.

```
예시: Growth Plan ($79) + AI Shorts ($49) = $128/mo
```

---

## 모듈 카테고리

```
┌─────────────────────────────────────────────────────────────┐
│                     MODULE CATEGORIES                        │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────┐                                            │
│  │    CORE     │  Website (필수)                            │
│  └─────────────┘                                            │
│                                                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ ENGAGEMENT  │  │   FINANCE   │  │ MANAGEMENT  │         │
│  │             │  │             │  │             │         │
│  │ • Mobile App│  │ • Giving    │  │ • Members   │         │
│  │ • Events    │  │             │  │ • Check-in  │         │
│  │ • Groups    │  │             │  │             │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                              │
│  ┌─────────────┐  ┌─────────────────────────────┐          │
│  │    MEDIA    │  │        AI CREATIVE          │          │
│  │             │  │                             │          │
│  │ • Streaming │  │ • AI Shorts (숏폼 영상)    │          │
│  │             │  │ • AI Social (SNS 콘텐츠)   │          │
│  └─────────────┘  └─────────────────────────────┘          │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 모듈 의존성

### 의존성 맵

```
                    ┌──────────────┐
                    │   Website    │  ← Core (Required)
                    │   (Core)     │
                    └──────┬───────┘
                           │
       ┌───────────────────┼───────────────────┐
       │                   │                   │
       ▼                   ▼                   ▼
┌──────────────┐   ┌──────────────┐   ┌──────────────┐
│   Members    │   │    Events    │   │    Groups    │
└──────┬───────┘   └──────┬───────┘   └──────┬───────┘
       │                  │                   │
       │                  │                   │
       ▼                  ▼                   │
┌──────────────┐   ┌──────────────┐           │
│   Check-in   │   │    Giving    │←──────────┘
│ (Members 필수)│   └──────────────┘
└──────────────┘

┌──────────────────────────────────────────────┐
│              Mobile App                       │
│        (활성화된 모듈 미러링)                 │
└──────────────────────────────────────────────┘

┌──────────────────┐  ┌──────────────────┐
│   Streaming      │  │   AI Modules     │
│   (독립 모듈)    │  │   (독립 모듈)    │
└──────────────────┘  └──────────────────┘
```

### 의존성 규칙

| 모듈 | 필수 의존성 (Hard) | 권장 의존성 (Soft) |
|------|-------------------|-------------------|
| Website | - | - |
| Members | Website | - |
| Events | Website | Members (참석자 관리) |
| Groups | Website | Members (그룹원 관리) |
| Giving | Website | Members (헌금자 추적) |
| Check-in | Website, Members | - |
| Mobile App | Website | - |
| Streaming | Website | - |
| AI Shorts | Website | Streaming (라이브 설교) |
| AI Social | Website | Events, Groups (콘텐츠 소스) |

### 의존성 검증 로직

```typescript
// 모듈 선택 검증
interface ValidationResult {
  valid: boolean;
  missingDependencies: string[];  // 필수 의존성
  recommendations: string[];       // 권장 의존성
}

// 예시: Check-in 선택 시
// - Members 없으면 → missingDependencies: ['members']
// - valid: false

// 예시: Giving 선택 시
// - Members 없으면 → recommendations: ['members']
// - valid: true (권장이지만 필수는 아님)
```

---

## 가격 정책

### 번들 할인

| 조건 | 할인율 |
|------|--------|
| 3개 이상 모듈 | 10% |
| 5개 이상 모듈 | 15% |
| 전체 모듈 (8개+) | 25% |

### 연간 결제 할인

- 연간 결제 시 **20% 추가 할인**

### 가격 계산 예시

#### 예시 1: 소형 교회 (Website + Giving)

```
기본 가격: $29 + $39 = $68/월
번들 할인: 해당 없음 (2개)
─────────────────────────
최종 가격: $68/월
```

#### 예시 2: 중형 교회 (4개 모듈, 연간 결제)

```
선택 모듈: Website + Mobile App + Members + Events
기본 가격: $29 + $49 + $29 + $19 = $126/월

번들 할인 (10%): -$12.60
소계: $113.40/월

연간 결제 할인 (20%): -$22.68
─────────────────────────
최종 가격: $90.72/월 ($1,088.64/년)
절감액: $35.28/월
```

#### 예시 3: 대형 교회 (전체 모듈, 연간 결제)

```
선택 모듈: 8개 전체
기본 가격: $29 + $49 + $39 + $29 + $19 + $19 + $59 + $29 = $272/월

번들 할인 (25%): -$68
소계: $204/월

연간 결제 할인 (20%): -$40.80
─────────────────────────
최종 가격: $163.20/월 ($1,958.40/년)
절감액: $108.80/월
```

---

## AI 크리에이티브 모듈

### AI Shorts Creator ($49/월)

설교 녹화에서 TikTok, YouTube Shorts, Instagram Reels용 숏폼 영상을 자동 생성합니다.

#### 주요 기능

| 기능 | 설명 |
|------|------|
| **자동 하이라이트 감지** | AI가 설교에서 인상적인 순간 자동 식별 |
| **자동 자막 생성** | 다국어 자막 자동 생성 (한/영/스페인어 등) |
| **템플릿 기반 편집** | 교회 브랜딩 적용된 템플릿 제공 |
| **멀티 플랫폼 최적화** | 플랫폼별 비율 자동 조정 (9:16, 1:1, 16:9) |
| **일괄 생성** | 하나의 설교에서 여러 클립 동시 생성 |

#### 워크플로우

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  설교 영상   │ →  │  AI 분석    │ →  │  클립 생성  │ →  │  SNS 배포   │
│   업로드    │    │ • 전사       │    │ • 편집      │    │ • TikTok    │
│             │    │ • 감정 분석  │    │ • 자막      │    │ • YouTube   │
│             │    │ • 핵심 추출  │    │ • 브랜딩    │    │ • Instagram │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

#### 월간 사용량 한도

| 티어 | 숏폼 영상/월 | 예상 비용/영상 |
|------|-------------|---------------|
| 기본 | 10개 | ~$0.50 |
| 표준 | 30개 | ~$0.50 |
| 프리미엄 | 100개 | ~$0.50 |
| 무제한 | ∞ | 별도 협의 |

### AI Social Studio ($39/월)

교회 콘텐츠에서 SNS 게시물(인용 그래픽, 이벤트 전단, 스토리)을 자동 생성합니다.

#### 주요 기능

| 기능 | 설명 |
|------|------|
| **설교 인용 그래픽** | 설교 핵심 문구를 시각적 카드로 변환 |
| **이벤트 홍보물** | 이벤트 정보 기반 전단/포스터 자동 생성 |
| **일정 게시물** | 교회 일정을 SNS 친화적 포맷으로 변환 |
| **성경 구절 그래픽** | 오늘의 말씀 등 성경 기반 콘텐츠 |
| **스토리 템플릿** | Instagram/Facebook 스토리 최적화 |

#### 콘텐츠 유형

```
┌────────────────────────────────────────────────────────────┐
│                  AI Social Content Types                    │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  Quote Cards    │  │  Event Flyers   │                  │
│  │                 │  │                 │                  │
│  │ "믿음은 바라는  │  │ ┌─────────────┐ │                  │
│  │  것들의 실상"   │  │ │ 부활절 예배 │ │                  │
│  │    - 히 11:1   │  │ │ 4월 9일     │ │                  │
│  └─────────────────┘  │ │ 오전 10시   │ │                  │
│                        │ └─────────────┘ │                  │
│  ┌─────────────────┐  └─────────────────┘                  │
│  │  Story Cards    │  ┌─────────────────┐                  │
│  │                 │  │  Weekly Verse   │                  │
│  │  [이번 주 설교] │  │                 │                  │
│  │   "희망의 능력" │  │  금주의 말씀    │                  │
│  │  ↓ 더보기       │  │  요한복음 3:16  │                  │
│  └─────────────────┘  └─────────────────┘                  │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

#### 월간 사용량 한도

| 티어 | 콘텐츠/월 | 예상 비용/콘텐츠 |
|------|----------|-----------------|
| 기본 | 50개 | ~$0.02 |
| 표준 | 200개 | ~$0.02 |
| 프리미엄 | 1,000개 | ~$0.02 |
| 무제한 | ∞ | 별도 협의 |

---

## AI 사용량 관리

### 사용량 모니터링

```
┌────────────────────────────────────────────────────────────┐
│                   AI Usage Dashboard                        │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  AI Shorts Usage                    AI Social Usage         │
│  ┌──────────────────────┐          ┌──────────────────────┐│
│  │ ████████████░░░░ 75% │          │ ██████░░░░░░░░░ 40%  ││
│  │ 23/30 clips used     │          │ 80/200 posts used    ││
│  └──────────────────────┘          └──────────────────────┘│
│                                                             │
│  ⚠️ AI Shorts: 75% 사용 - 7개 남음                          │
│                                                             │
│  Monthly Reset: 15일 후                                     │
│  [추가 구매] [사용 내역 보기]                               │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

### 사용량 알림

| 사용률 | 알림 유형 | 조치 |
|--------|----------|------|
| 75% | 이메일 알림 | 정보 제공 |
| 90% | 이메일 + 대시보드 경고 | 추가 구매 권장 |
| 100% | 이메일 + 기능 제한 | 추가 구매 필요 |

### 추가 할당량 구매

| 추가 옵션 | AI Shorts | AI Social |
|----------|-----------|-----------|
| 10개 팩 | $5 | $1 |
| 50개 팩 | $20 | $4 |
| 100개 팩 | $35 | $7 |

---

## 모듈 데이터 관리

### 데이터 보존 정책

모듈 비활성화 시 데이터 처리 정책:

| 단계 | 기간 | 상태 | 데이터 접근 |
|------|------|------|------------|
| 비활성화 | 즉시 | CANCELLED | 읽기 전용 |
| 보존 기간 | 30일 | ACTIVE | 복원 가능 |
| 내보내기 기간 | 30일 | EXPORTED | 다운로드 가능 |
| 삭제 예정 | 30일 후 | PURGE_SCHEDULED | 마지막 경고 |
| 영구 삭제 | 30일 후 | PURGED | 불가 |

### 데이터 보존 흐름

```
모듈 비활성화
     │
     ▼
┌─────────────────────┐
│  30일 유예 기간     │  ← 이 기간 동안 재활성화 시 즉시 복원
│  (데이터 보존)      │
└─────────────────────┘
     │
     ▼
┌─────────────────────┐
│  데이터 내보내기    │  ← JSON 형식 다운로드 제공
│  링크 발송          │     (72시간 유효)
└─────────────────────┘
     │
     ▼
┌─────────────────────┐
│  영구 삭제          │  ← 복구 불가
└─────────────────────┘
```

### 모듈별 데이터 처리

| 모듈 | 비활성화 시 처리 | 특별 고려사항 |
|------|-----------------|--------------|
| Giving | 기록 보존 (법적/세금) | 헌금 기록은 영구 보존 |
| Members | 30일 보존 후 삭제 | 개인정보 GDPR 준수 |
| AI Shorts | 생성 영상 삭제 | 스토리지 즉시 해제 |
| AI Social | 생성 콘텐츠 삭제 | - |

---

## Stripe 연동

### 모듈별 구독 아이템

```
┌────────────────────────────────────────────────────────────┐
│               Stripe Subscription Structure                 │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  Customer (Tenant)                                          │
│  └── Subscription                                           │
│      ├── Item: Website ($29/mo)     [price_website_monthly] │
│      ├── Item: Giving ($39/mo)      [price_giving_monthly]  │
│      ├── Item: Members ($29/mo)     [price_members_monthly] │
│      └── Item: AI Shorts ($49/mo)   [price_shorts_monthly]  │
│                                                             │
│  Proration: Enabled (즉시 적용, 비례 계산)                  │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

### 모듈 추가/제거 플로우

```
모듈 추가 요청
     │
     ▼
┌─────────────────────┐
│  의존성 검증        │  ← 필수 모듈 확인
└─────────────────────┘
     │
     ▼
┌─────────────────────┐
│  Stripe Item 추가   │  ← subscriptionItems.create()
│  (프로레이션 적용)  │
└─────────────────────┘
     │
     ▼
┌─────────────────────┐
│  TenantModule 생성  │  ← DB 레코드 생성
└─────────────────────┘
     │
     ▼
┌─────────────────────┐
│  모듈 초기화        │  ← 기본 데이터 설정
└─────────────────────┘
```

---

## 사용 사례 시나리오

### 시나리오 1: 신규 교회 시작

```
1. 온보딩 시작
2. 교회 정보 입력
3. 모듈 선택: Website (필수) + Giving
4. 결제 정보 등록
5. 초기 설정 완료

비용: $68/월
```

### 시나리오 2: 성장하는 교회 확장

```
기존: Website + Giving ($68/월)

확장 요청:
- Members 추가 (+$29)
- Events 추가 (+$19)
- Mobile App 추가 (+$49)

신규 합계: $165/월
번들 할인 (10%): -$16.50
─────────────────────────
최종: $148.50/월 (원래 $165에서 절감)
```

### 시나리오 3: AI 기능 도입

```
기존: Website + Members + Giving ($97/월)

AI 모듈 추가:
- AI Shorts (+$49)
- AI Social (+$39)

신규 합계: $185/월
번들 할인 (15% - 5개 모듈): -$27.75
─────────────────────────
최종: $157.25/월
```

### 시나리오 4: 모듈 다운그레이드

```
기존: 5개 모듈 ($157.25/월)

제거 요청: AI Shorts

프로세스:
1. 제거 확인 다이얼로그
2. 데이터 보존 안내 (30일)
3. Stripe 구독 아이템 제거
4. 다음 결제 주기부터 적용

신규 합계: 4개 모듈
번들 할인 (10%): 적용
최종: ~$125/월
```

---

## 레거시 Plan 마이그레이션

### Plan → Modular 전환 매핑

| 기존 Plan | 전환 모듈 |
|-----------|----------|
| Starter | Website |
| Growth | Website, Members, Giving, Events |
| Pro | Website, Members, Giving, Events, Mobile App, Groups |
| Enterprise | 전체 모듈 |

### 마이그레이션 전략

1. **자동 전환**: 기존 Plan 기능을 해당 모듈로 자동 매핑
2. **가격 보장**: 기존 고객 가격 12개월 보장
3. **점진적 전환**: 신규 가입자부터 Modular 모델 적용
4. **하이브리드 지원**: Plan + 추가 모듈 조합 허용

---

## 관리자 대시보드 기능

### 모듈 관리 화면

```
┌────────────────────────────────────────────────────────────┐
│                  Solution Module Management                 │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  Active Modules (4)                                         │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ✓ Website          $29/mo    [Settings] [Required]   │  │
│  │ ✓ Giving           $39/mo    [Settings] [Remove]     │  │
│  │ ✓ Members          $29/mo    [Settings] [Remove]     │  │
│  │ ✓ Events           $19/mo    [Settings] [Remove]     │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  Available Modules                                          │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ○ Mobile App       $49/mo    [+ Add]                 │  │
│  │ ○ Groups           $19/mo    [+ Add]                 │  │
│  │ ○ Streaming        $59/mo    [+ Add]                 │  │
│  │ ○ Check-in         $29/mo    [+ Add] ⚠️ Requires Members│
│  │ ○ AI Shorts        $49/mo    [+ Add]                 │  │
│  │ ○ AI Social        $39/mo    [+ Add]                 │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  Current Monthly: $116                                      │
│  Bundle Discount: -$11.60 (10%)                             │
│  ─────────────────────────────────                          │
│  Total: $104.40/month                                       │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

---

## 기술 구현 요약

### 핵심 엔티티

| 엔티티 | 설명 |
|--------|------|
| SolutionModule | 모듈 카탈로그 (가격, 기능, 의존성) |
| TenantModule | 테넌트별 모듈 구독 상태 |
| ModuleDependency | 모듈 간 의존성 관계 |
| ModuleAddon | 모듈별 추가 옵션 (스토리지, API 콜 등) |
| AIUsageQuota | AI 모듈 월간 사용량 |

### 구현 우선순위

| 단계 | 기능 | 중요도 |
|------|------|--------|
| Phase 1 | 모듈 카탈로그, 의존성 검증 | 필수 |
| Phase 1 | 온보딩 모듈 선택 UI | 필수 |
| Phase 1 | Stripe 모듈별 구독 | 필수 |
| Phase 2 | 모듈 추가/제거 관리 | 필수 |
| Phase 2 | 번들 할인 자동 적용 | 필수 |
| Phase 3 | AI 모듈 (Shorts, Social) | 선택 |
| Phase 3 | 사용량 추적 및 알림 | 선택 |
| Phase 4 | 데이터 보존 및 내보내기 | 선택 |

---

**Document Version**: 3.0 Enterprise Edition
**Related Documents**:
- [03-system-architecture.md](./03-system-architecture.md) - 모듈 통합 아키텍처
- [04-multi-tenant-architecture.md](./04-multi-tenant-architecture.md) - 모듈 게이팅
- [06-feature-modules.md](./06-feature-modules.md) - 각 모듈 상세 명세
